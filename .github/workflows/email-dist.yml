name: TSV to Encrypted Radix { ! }
on:
  workflow_dispatch:
    inputs:
      tsv-path:
        description: Path To TSV File
        required: true
        type: string
      relay-peer:
        description: Relay peers (separated by comma)
        required: true
        type: string
      service-name:
        description: Service name for traefik
        required: true
        type: string
      stack-name:
        description: Stack name for swarm deploy
        required: true
        type: string
# App authentication only works iff SEA Keypair is destructured. Best to use repository secrets
jobs:
  deploy_app:
    runs-on:
      - self-hosted
      - main-server
    steps:
      - uses: actions/checkout@v3
      - name: Export Shell Prfix & Deploy ${{ inputs.stack-name }}_app
        env:
          TSV_PATH: ${{ inputs.tsv-path }}
          PEERS: ${{ inputs.relay-peer }}
          PUB: ${{ secrets.PUB }}
          PRIV: ${{ secrets.PRIV }}
          EPUB: ${{ secrets.EPUB }}
          EPRIV: ${{ secrets.EPRIV }}
        run: |
          yarn
          node scripts/esm/tsv/email-dist.mjs
